{"ast":null,"code":"var _jsxFileName = \"/Users/AliceXu/Desktop/uni/Y4 Semester 1/INFO2222/INFO2222-Assignment-1-main/client/src/Friends.js\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useState } from 'react';\nimport { Table, Form, Button, Container, Col, Row } from 'react-bootstrap';\nimport * as encryption from './encryption';\nimport { getCookie, post, get } from './Helpers';\nimport Chat from \"./Chat\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Friends() {\n  _s();\n\n  const [isLoading, setIsLoading] = useState(true);\n  const [friends, setFriends] = useState([]);\n  const username = getCookie('username');\n\n  async function getFriends() {\n    let response = await fetch('/getFriends');\n    let data = await response.json();\n    setIsLoading(false);\n    setFriends(data.friends);\n  }\n\n  async function addFriend(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let friend = e.nativeEvent.target[0].value;\n\n    if (friend === \"\") {\n      return;\n    }\n\n    const storageKeyName = username + friend + 'sk';\n    let symmKey = localStorage.getItem(storageKeyName);\n    if (symmKey) return;\n    symmKey = await encryption.generateAESKey();\n    symmKey = await encryption.exportKey(symmKey);\n    symmKey = JSON.stringify(symmKey);\n    let data = await get(`/getFriendPk?receiver=${friend}`);\n    const friendPk = await encryption.importPublicKey(data.publicKey);\n    const msgObj = new encryption.PlaintextMessage(symmKey);\n    const encSymmKey = await msgObj.encrypt(friendPk);\n    let formData = new FormData();\n    formData.append('friend', friend);\n    formData.append('key', encSymmKey);\n    await post('/addFriend', formData);\n    localStorage.setItem(storageKeyName, symmKey);\n    await getFriends();\n  }\n\n  function friendsTable() {\n    const table = friends.map(friend => {\n      const href = {\n        href: `/chat?name=${friend}`\n      };\n      return /*#__PURE__*/_jsxDEV(\"tr\", {\n        children: [/*#__PURE__*/_jsxDEV(\"td\", {\n          children: friend\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 54,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n          children: /*#__PURE__*/_jsxDEV(\"a\", { ...href,\n            children: \"Chat\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 55,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 55,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 53,\n        columnNumber: 17\n      }, this);\n    });\n    return /*#__PURE__*/_jsxDEV(\"tbody\", {\n      children: table\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 13\n    }, this);\n  }\n\n  useEffect(() => {\n    getFriends();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"d-flex justify-content-center mt-5\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        width: '100%'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Friends List\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 17\n      }, this), isLoading || friends.length === 0 ? 'There are currently no friends.' : /*#__PURE__*/_jsxDEV(Table, {\n        striped: true,\n        bordered: true,\n        hover: true,\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Username\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 83,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 84,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 82,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 25\n        }, this), friendsTable()]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(Form, {\n        onSubmit: addFriend,\n        children: /*#__PURE__*/_jsxDEV(Form.Group, {\n          className: \"row form-group mt-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-sm-8\",\n            children: /*#__PURE__*/_jsxDEV(Form.Control, {\n              type: \"text\",\n              placeholder: \"Username\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 94,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 93,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            className: \"col-sm-3\",\n            variant: \"outline-dark\",\n            type: \"submit\",\n            children: \"Add Friend\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 96,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 72,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Friends, \"iG5bwZbdyPVsH1ORc6O25cRvUbA=\");\n\n_c = Friends;\nexport default Friends;\n\nvar _c;\n\n$RefreshReg$(_c, \"Friends\");","map":{"version":3,"sources":["/Users/AliceXu/Desktop/uni/Y4 Semester 1/INFO2222/INFO2222-Assignment-1-main/client/src/Friends.js"],"names":["useEffect","useState","Table","Form","Button","Container","Col","Row","encryption","getCookie","post","get","Chat","Friends","isLoading","setIsLoading","friends","setFriends","username","getFriends","response","fetch","data","json","addFriend","e","preventDefault","stopPropagation","friend","nativeEvent","target","value","storageKeyName","symmKey","localStorage","getItem","generateAESKey","exportKey","JSON","stringify","friendPk","importPublicKey","publicKey","msgObj","PlaintextMessage","encSymmKey","encrypt","formData","FormData","append","setItem","friendsTable","table","map","href","width","length"],"mappings":"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","sourcesContent":["import { useEffect, useState } from 'react';\nimport {Table, Form, Button, Container, Col, Row} from 'react-bootstrap';\nimport * as encryption from './encryption';\nimport { getCookie, post, get } from './Helpers';\nimport Chat from \"./Chat\";\n\nfunction Friends() {\n    const [isLoading, setIsLoading] = useState(true);\n    const [friends, setFriends] = useState([]);\n    const username = getCookie('username');\n\n    async function getFriends() {\n        let response = await fetch('/getFriends');\n        let data = await response.json();\n        setIsLoading(false);\n        setFriends(data.friends);\n    }\n\n    async function addFriend(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        let friend = e.nativeEvent.target[0].value;\n        if(friend === \"\") {\n            return;\n        }\n\n        const storageKeyName = username+friend+'sk';\n        let symmKey = localStorage.getItem(storageKeyName);\n        if(symmKey)\n            return;\n        symmKey = await encryption.generateAESKey();\n        symmKey = await encryption.exportKey(symmKey);\n        symmKey = JSON.stringify(symmKey);\n\n        let data = await get(`/getFriendPk?receiver=${friend}`);\n        const friendPk = await encryption.importPublicKey(data.publicKey);\n        const msgObj = new encryption.PlaintextMessage(symmKey);\n        const encSymmKey = await msgObj.encrypt(friendPk);\n\n        let formData = new FormData();\n        formData.append('friend', friend);\n        formData.append('key', encSymmKey);\n        await post('/addFriend', formData);\n        localStorage.setItem(storageKeyName, symmKey);\n        await getFriends();\n    }\n\n    function friendsTable() {\n        const table = friends.map(friend => {\n            const href = { href: `/chat?name=${friend}`};\n            return (\n                <tr>\n                    <td>{friend}</td>\n                    <td><a {...href}>Chat</a></td>\n                </tr>\n            )\n        });\n        return (\n            <tbody>\n                {table}\n            </tbody>\n        )\n    }\n\n    useEffect(() => {\n        getFriends()\n    }, []);\n\n    return (\n\n        <div className=\"d-flex justify-content-center mt-5\">\n            <div style={{width: '100%'}}>\n\n                <h3>Friends List</h3>\n                {\n                    isLoading || friends.length === 0 ? 'There are currently no friends.':\n                    <Table striped bordered hover>\n\n\n                        <thead>\n                            <tr>\n                                <th>Username</th>\n                                <th></th>\n                            </tr>\n                        </thead>\n                        {friendsTable()}\n                    </Table>\n                }\n\n                <Form onSubmit={addFriend}>\n                    <Form.Group className=\"row form-group mt-2\">\n                        <div className=\"col-sm-8\">\n                            <Form.Control type=\"text\" placeholder=\"Username\"/>\n                        </div>\n                        <Button className=\"col-sm-3\" variant=\"outline-dark\" type=\"submit\">\n                            Add Friend\n                        </Button>\n                    </Form.Group>\n                </Form>\n\n            </div>\n        </div>\n\n    );\n}\n\nexport default Friends;"]},"metadata":{},"sourceType":"module"}