{"ast":null,"code":"var _jsxFileName = \"/Users/AliceXu/Desktop/uni/Y4 Semester 1/INFO2222/INFO2222-Assignment-1-main/client/src/Forum/Forum.js\";\nimport { Component } from 'react';\nimport { ListGroup, Button, Form, InputGroup, FormControl, Modal } from 'react-bootstrap';\nimport { timestampToTimeString, get, post, getCookie } from '../Helpers';\nimport \"./forum.css\";\nimport { forEach } from \"react-bootstrap/ElementChildren\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar [BLANK, ADD_POST, SHOW_POST] = [0, 1, 2];\n\nclass Forum extends Component {\n  constructor(props) {\n    super(props);\n\n    this.getMuted = async () => {\n      let muted = await get(\"/getMutedStatus\");\n      console.log(muted[\"muted\"]);\n      this.state.muted = muted[\"muted\"];\n      return muted[\"muted\"];\n    };\n\n    this.getPosts = async () => {\n      let {\n        posts\n      } = await get(\"/getPostList\");\n      this.setState({\n        posts\n      });\n      this.setState({\n        displayedPosts: posts\n      });\n\n      if (posts.length > 0) {\n        this.getPost(posts[0][0]);\n      } else {\n        this.setState({\n          activeIndex: -1\n        });\n        this.setState({\n          mainPanel: ADD_POST\n        });\n      }\n    };\n\n    this.getPost = async id => {\n      let {\n        post\n      } = await get(`/getPost?id=${id}`);\n      this.setState({\n        activeIndex: id,\n        mainPanel: SHOW_POST,\n        post: post\n      });\n    };\n\n    this.filterPosts = e => {\n      let text = e.target.value.toLowerCase();\n\n      if (text === \"\" && this.state.displayedPosts !== this.state.posts) {\n        this.setState({\n          displayedPosts: this.state.posts\n        });\n      } else {\n        let filteredPosts = this.state.posts.filter(post => {\n          return post[1].toLowerCase().indexOf(text) > -1 || post[2].toLowerCase().indexOf(text) > -1 || post[3].toLowerCase().indexOf(text) > -1;\n        });\n        this.setState({\n          displayedPosts: filteredPosts\n        });\n      }\n    };\n\n    this.addPost = async e => {\n      const form = e.currentTarget;\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (form.checkValidity()) {\n        let title = e.nativeEvent.target[0].value;\n        let body = e.nativeEvent.target[1].value;\n        let formData = new FormData();\n        formData.append(\"title\", title);\n        formData.append(\"body\", body);\n        await post('/addPost', formData);\n        await this.getPosts();\n      } else {\n        this.setState({\n          addPostFormValidated: true\n        });\n      }\n    };\n\n    this.closeModal = () => {\n      this.setState({\n        showDeletePostModal: false\n      });\n    };\n\n    this.openModal = () => {\n      this.setState({\n        showDeletePostModal: true\n      });\n    };\n\n    this.deletePosts = async () => {\n      for (const e of this.state.changeList) {\n        const form = new FormData();\n        form.append(\"changeList\", e);\n        await post('/deletePosts', form);\n      }\n\n      await this.getPosts();\n    };\n\n    this.addComment = async e => {\n      const form = e.currentTarget;\n      e.preventDefault();\n      e.stopPropagation();\n      let comment = e.nativeEvent.target[0].value;\n\n      if (comment !== \"\") {\n        let formData = new FormData();\n        formData.append(\"body\", comment);\n        formData.append(\"postId\", this.state.activeIndex);\n        await post('/addComment', formData);\n        await this.getPost(this.state.activeIndex);\n        form.reset();\n      }\n    };\n\n    this.state = {\n      mainPanel: BLANK,\n      activeIndex: -1,\n      //-1 is a filler for no posts being active\n      posts: [],\n      displayedPosts: [],\n      post: {},\n      addPostFormValidated: false,\n      changeList: [],\n      muted: false,\n      showDeletePostModal: false\n    };\n    this.isAdmin = getCookie('admin');\n    this.getPosts();\n    this.getMuted();\n  }\n\n  updateChangeList(id) {\n    if (this.state.changeList.includes(id)) {\n      const index = this.state.changeList.indexOf(id);\n\n      if (index > -1) {\n        this.state.changeList.splice(index, 1);\n      }\n    } else {\n      this.state.changeList.push(id);\n    }\n\n    console.log(this.state.changeList);\n  }\n\n  renderMainPanel() {\n    switch (this.state.mainPanel) {\n      case ADD_POST:\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"post-main-panel-inner\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"header\",\n            children: \"Add Post\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 145,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"body\",\n            children: /*#__PURE__*/_jsxDEV(Form, {\n              noValidate: true,\n              validated: this.state.addPostFormValidated,\n              onSubmit: this.addPost,\n              children: [/*#__PURE__*/_jsxDEV(Form.Group, {\n                className: \"mb-3 form-row\",\n                controlId: \"postTitle\",\n                children: [/*#__PURE__*/_jsxDEV(Form.Label, {\n                  className: \"form-label\",\n                  children: \"Title\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 149,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                  className: \"form-input\",\n                  type: \"text\",\n                  required: true\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 150,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(Form.Control.Feedback, {\n                  type: \"invalid\",\n                  children: \"Please enter a title.\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 151,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 148,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(Form.Group, {\n                className: \"mb-3 form-row\",\n                controlId: \"postContent\",\n                children: [/*#__PURE__*/_jsxDEV(Form.Control, {\n                  type: \"text\",\n                  required: true,\n                  as: \"textarea\",\n                  placeholder: \"Enter post here\",\n                  style: {\n                    height: \"200px\",\n                    resize: \"none\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 155,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(Form.Control.Feedback, {\n                  type: \"invalid\",\n                  children: \"Please enter a post.\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 156,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 154,\n                columnNumber: 33\n              }, this), this.state.muted === false ? /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"primary\",\n                type: \"submit\",\n                children: \"Submit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 162,\n                columnNumber: 37\n              }, this) : /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"primary\",\n                type: \"submit\",\n                disabled: true,\n                children: \"Submit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 165,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 147,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 146,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 21\n        }, this);\n\n      case SHOW_POST:\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"post-main-panel-inner\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"header\",\n            children: this.state.post[1]\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 176,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"body\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"post-body\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"author\",\n                children: this.state.post[2]\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 181,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"time\",\n                children: [\"Posted on \", timestampToTimeString(this.state.post[4])]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 184,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"content\",\n                children: this.state.post[3]\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 187,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(Form, {\n                onSubmit: this.addComment,\n                children: /*#__PURE__*/_jsxDEV(InputGroup, {\n                  className: \"mb-3\",\n                  children: [/*#__PURE__*/_jsxDEV(FormControl, {\n                    placeholder: \"Add a comment\",\n                    \"aria-label\": \"Comment\",\n                    \"aria-describedby\": \"add-comment\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 192,\n                    columnNumber: 41\n                  }, this), this.state.muted === false ? /*#__PURE__*/_jsxDEV(Button, {\n                    variant: \"outline-dark\",\n                    id: \"add-comment\",\n                    type: \"submit\",\n                    children: \"Send\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 197,\n                    columnNumber: 49\n                  }, this) : /*#__PURE__*/_jsxDEV(Button, {\n                    variant: \"outline-dark\",\n                    id: \"add-comment\",\n                    type: \"submit\",\n                    disabled: true,\n                    children: \"Send\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 201,\n                    columnNumber: 49\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 191,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 190,\n                columnNumber: 33\n              }, this), this.state.post[5].map(comment => {\n                return /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"comment-box\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"comment-author\",\n                    children: [comment[2], \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n                      className: \"comment-time\",\n                      children: timestampToTimeString(comment[4])\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 211,\n                      columnNumber: 94\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 211,\n                    columnNumber: 49\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"comment\",\n                    children: comment[3]\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 212,\n                    columnNumber: 49\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 210,\n                  columnNumber: 45\n                }, this);\n              })]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 180,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 21\n        }, this);\n\n      default:\n        return /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 21\n        }, this);\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"main-body p-0\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"inner-wrapper\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"post-list-panel\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"header\",\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              className: \"new-post-button\",\n              onClick: () => {\n                this.setState({\n                  mainPanel: ADD_POST,\n                  activeIndex: -1\n                });\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                xmlns: \"http://www.w3.org/2000/svg\",\n                width: \"16\",\n                height: \"16\",\n                fill: \"currentColor\",\n                className: \"bi bi-pencil-square\",\n                viewBox: \"0 0 16 16\",\n                children: [/*#__PURE__*/_jsxDEV(\"path\", {\n                  d: \"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 237,\n                  columnNumber: 33\n                }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n                  fillRule: \"evenodd\",\n                  d: \"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 238,\n                  columnNumber: 33\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 236,\n                columnNumber: 29\n              }, this), \"\\xA0Add Post\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 235,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 234,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(InputGroup, {\n            className: \"search-bar\",\n            children: /*#__PURE__*/_jsxDEV(FormControl, {\n              \"aria-label\": \"Small\",\n              \"aria-describedby\": \"inputGroup-sizing-md\",\n              placeholder: \"Search for post\",\n              onChange: this.filterPosts\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 244,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(ListGroup, {\n            bsPrefix: \"post-list\",\n            children: this.state.displayedPosts.map(post => {\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                children: /*#__PURE__*/_jsxDEV(ListGroup.Item, {\n                  action: true,\n                  bsPrefix: \"post-list-item\",\n                  as: \"div\",\n                  onClick: () => this.getPost(post[0]),\n                  active: this.state.activeIndex === post[0],\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"post-list-item-header\",\n                    children: post[1]\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 252,\n                    columnNumber: 45\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"post-list-item-body\",\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"post-list-item-author\",\n                      children: post[2]\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 254,\n                      columnNumber: 49\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"post-list-item-time\",\n                      children: timestampToTimeString(post[4])\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 255,\n                      columnNumber: 49\n                    }, this), this.isAdmin === \"true\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"form-check\",\n                      children: /*#__PURE__*/_jsxDEV(\"input\", {\n                        className: \"form-check-input\",\n                        type: \"checkbox\",\n                        value: post[0],\n                        id: \"check\" + post[0],\n                        onClick: () => this.updateChangeList(post[0])\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 258,\n                        columnNumber: 53\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 257,\n                      columnNumber: 49\n                    }, this) : null]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 253,\n                    columnNumber: 45\n                  }, this)]\n                }, post[0], true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 251,\n                  columnNumber: 41\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 250,\n                columnNumber: 41\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 246,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Modal, {\n            show: this.state.showDeletePostModal,\n            onHide: this.closeModal,\n            children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n              closeButton: true,\n              children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n                children: \"Delete Posts\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 275,\n                columnNumber: 29\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 274,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n              children: \"Are you sure you want to delete the selected posts?\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 277,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n              children: [/*#__PURE__*/_jsxDEV(Button, {\n                variant: \"secondary\",\n                onClick: this.closeModal,\n                children: \"Close\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 279,\n                columnNumber: 29\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"danger\",\n                onClick: async () => {\n                  this.closeModal();\n                  await this.deletePosts();\n                },\n                children: \"Delete\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 282,\n                columnNumber: 29\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 278,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"delete-button\",\n            style: {\n              display: this.isAdmin ? \"block\" : \"none\"\n            },\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"danger\",\n              onClick: this.openModal,\n              children: \"Delete selected posts\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 291,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 290,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"post-main-panel\",\n          children: this.state.activeIndex || this.state.mainPanel || true ? this.renderMainPanel() : \"\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Forum;","map":{"version":3,"sources":["/Users/AliceXu/Desktop/uni/Y4 Semester 1/INFO2222/INFO2222-Assignment-1-main/client/src/Forum/Forum.js"],"names":["Component","ListGroup","Button","Form","InputGroup","FormControl","Modal","timestampToTimeString","get","post","getCookie","forEach","BLANK","ADD_POST","SHOW_POST","Forum","constructor","props","getMuted","muted","console","log","state","getPosts","posts","setState","displayedPosts","length","getPost","activeIndex","mainPanel","id","filterPosts","e","text","target","value","toLowerCase","filteredPosts","filter","indexOf","addPost","form","currentTarget","preventDefault","stopPropagation","checkValidity","title","nativeEvent","body","formData","FormData","append","addPostFormValidated","closeModal","showDeletePostModal","openModal","deletePosts","changeList","addComment","comment","reset","isAdmin","updateChangeList","includes","index","splice","push","renderMainPanel","height","resize","map","render","display"],"mappings":"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","sourcesContent":["import { Component } from 'react';\nimport { ListGroup, Button, Form, InputGroup, FormControl, Modal } from 'react-bootstrap'\nimport {timestampToTimeString, get, post, getCookie} from '../Helpers'\nimport \"./forum.css\"\nimport {forEach} from \"react-bootstrap/ElementChildren\";\n\nvar [BLANK, ADD_POST, SHOW_POST] = [0, 1, 2];\n\nclass Forum extends Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            mainPanel: BLANK,\n            activeIndex: -1, //-1 is a filler for no posts being active\n            posts: [],\n            displayedPosts: [],\n            post: {},\n            addPostFormValidated: false,\n            changeList: [],\n            muted: false,\n            showDeletePostModal: false\n        }\n        this.isAdmin = getCookie('admin');\n\n        this.getPosts();\n        this.getMuted();\n    }\n\n    getMuted = async () => {\n        let muted = await get(\"/getMutedStatus\");\n        console.log(muted[\"muted\"])\n        this.state.muted = muted[\"muted\"];\n        return muted[\"muted\"];\n    }\n\n    getPosts = async () => {\n        let { posts } = await get(\"/getPostList\");\n        this.setState({ posts });\n        this.setState({ displayedPosts: posts });\n        if(posts.length > 0) {\n            this.getPost(posts[0][0]);\n        }\n        else {\n            this.setState({ activeIndex: -1 });\n            this.setState({ mainPanel: ADD_POST });\n        }\n    }\n\n    getPost = async (id) => {\n        let { post } = await get(`/getPost?id=${id}`);\n        this.setState({ activeIndex: id, mainPanel: SHOW_POST, post: post });\n    }\n\n    filterPosts = (e) => {\n        let text = e.target.value.toLowerCase();\n        if (text === \"\" && (this.state.displayedPosts !== this.state.posts)) {\n            this.setState({ displayedPosts: this.state.posts });\n        }\n        else {\n            let filteredPosts = this.state.posts.filter((post) => {\n                return post[1].toLowerCase().indexOf(text) > -1 \n                || post[2].toLowerCase().indexOf(text) > -1\n                || post[3].toLowerCase().indexOf(text) > -1;\n            });\n            this.setState({ displayedPosts: filteredPosts });\n        }\n    }\n\n    addPost = async (e) => {\n        const form = e.currentTarget;\n\n        e.preventDefault();\n        e.stopPropagation();\n        \n        if (form.checkValidity()) {\n            let title = e.nativeEvent.target[0].value;\n            let body = e.nativeEvent.target[1].value;\n\n            let formData = new FormData();\n            formData.append(\"title\", title);\n            formData.append(\"body\", body);\n\n            await post('/addPost', formData);\n            await this.getPosts();\n        }\n        else {\n            this.setState({ addPostFormValidated: true });\n        }\n    }\n\n    closeModal = () => {\n        this.setState({ showDeletePostModal: false });\n    }\n\n    openModal = () => {\n        this.setState({ showDeletePostModal: true });\n    }\n\n    deletePosts = async () => {\n        for (const e of this.state.changeList) {\n            const form = new FormData();\n            form.append(\"changeList\", e);\n            await post('/deletePosts', form);\n        }\n        await this.getPosts();\n    }\n\n    addComment = async (e) => {\n        const form = e.currentTarget;\n        e.preventDefault();\n        e.stopPropagation();\n        let comment = e.nativeEvent.target[0].value;\n        \n        if (comment !== \"\") {\n            let formData = new FormData();\n            formData.append(\"body\", comment);\n            formData.append(\"postId\", this.state.activeIndex);\n            await post('/addComment', formData);\n            await this.getPost(this.state.activeIndex);\n            form.reset();\n        }\n\n    }\n\n    updateChangeList(id){\n\n        if (this.state.changeList.includes(id)){\n            const index = this.state.changeList.indexOf(id);\n            if (index > -1) {\n                this.state.changeList.splice(index, 1);\n            }\n        }\n        else{\n            this.state.changeList.push(id)\n        }\n        console.log( this.state.changeList)\n    }\n\n    renderMainPanel() {\n        switch(this.state.mainPanel) {\n            case ADD_POST:\n                return (\n                    <div className=\"post-main-panel-inner\">\n                        <div className=\"header\">Add Post</div>\n                        <div className=\"body\">\n                            <Form noValidate validated={this.state.addPostFormValidated} onSubmit={this.addPost}>\n                                <Form.Group className=\"mb-3 form-row\" controlId=\"postTitle\">\n                                    <Form.Label className=\"form-label\">Title</Form.Label>\n                                    <Form.Control className=\"form-input\" type=\"text\" required/>\n                                    <Form.Control.Feedback type=\"invalid\">Please enter a title.</Form.Control.Feedback>\n                                </Form.Group>\n\n                                <Form.Group className=\"mb-3 form-row\" controlId=\"postContent\">\n                                    <Form.Control type=\"text\" required as=\"textarea\" placeholder=\"Enter post here\" style={{ height: \"200px\", resize: \"none\"}}/>\n                                    <Form.Control.Feedback type=\"invalid\">Please enter a post.</Form.Control.Feedback>\n                                </Form.Group>\n\n                                {\n                                this.state.muted === false ?\n\n                                    <Button variant=\"primary\" type=\"submit\">\n                                        Submit\n                                    </Button> :\n                                    <Button variant=\"primary\" type=\"submit\" disabled>\n                                        Submit\n                                    </Button>\n                                }\n                            </Form>\n                        </div>\n                    </div>\n                );\n            case SHOW_POST:\n                return (\n                    <div className=\"post-main-panel-inner\">\n                        <div className=\"header\">\n                            {this.state.post[1]}\n                        </div>\n                        <div className=\"body\">\n                            <div className=\"post-body\">\n                                <div className=\"author\">\n                                    {this.state.post[2]}\n                                </div>\n                                <div className=\"time\">\n                                    Posted on {timestampToTimeString(this.state.post[4])}\n                                </div>\n                                <div className=\"content\">\n                                    {this.state.post[3]}\n                                </div>\n                                <Form onSubmit={this.addComment}>\n                                    <InputGroup className=\"mb-3\">\n                                        <FormControl placeholder=\"Add a comment\" aria-label=\"Comment\" aria-describedby=\"add-comment\"/>\n\n                                        {\n                                            this.state.muted === false ?\n\n                                                <Button variant=\"outline-dark\" id=\"add-comment\" type=\"submit\">\n                                                    Send\n                                                </Button>\n                                                :\n                                                <Button variant=\"outline-dark\" id=\"add-comment\" type=\"submit\" disabled>\n                                                    Send\n                                                </Button>\n                                        }\n                                    </InputGroup>\n                                </Form>\n                                {\n                                    this.state.post[5].map((comment) => {\n                                        return (\n                                            <div className=\"comment-box\">\n                                                <div className=\"comment-author\">{comment[2]} <span className=\"comment-time\">{timestampToTimeString(comment[4])}</span></div>\n                                                <div className=\"comment\">{comment[3]}</div>\n                                            </div>\n                                        )\n                                    })\n                                }\n                            </div>\n                        </div>\n                    </div>\n                );\n            default:\n                return (\n                    <div></div>\n                )\n                    \n        }\n    }\n\n    render() {\n        return (\n            <div className=\"main-body p-0\">\n                <div className=\"inner-wrapper\">\n                    <div className=\"post-list-panel\">\n                        <div className=\"header\">\n                            <Button className=\"new-post-button\" onClick={() => { this.setState({ mainPanel: ADD_POST, activeIndex: -1}) }}>\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" className=\"bi bi-pencil-square\" viewBox=\"0 0 16 16\">\n                                <path d=\"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z\"/>\n                                <path fillRule=\"evenodd\" d=\"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z\"/>\n                            </svg>\n                            &nbsp;Add Post\n                            </Button>\n                        </div>\n                        <InputGroup className=\"search-bar\">\n                            <FormControl aria-label=\"Small\" aria-describedby=\"inputGroup-sizing-md\" placeholder=\"Search for post\" onChange={this.filterPosts}/>\n                        </InputGroup>\n                        <ListGroup bsPrefix=\"post-list\">\n                            {\n                                this.state.displayedPosts.map((post) => {\n                                    return (\n                                        <div>\n                                        <ListGroup.Item key={post[0]} action bsPrefix=\"post-list-item\" as=\"div\" onClick={() => this.getPost(post[0])} active={this.state.activeIndex === post[0]}>\n                                            <div className=\"post-list-item-header\">{post[1]}</div>\n                                            <div className=\"post-list-item-body\">\n                                                <div className=\"post-list-item-author\">{post[2]}</div>\n                                                <div className=\"post-list-item-time\">{timestampToTimeString(post[4])}</div>\n                                                {this.isAdmin === \"true\" ?\n                                                <div className=\"form-check\" >\n                                                    <input className=\"form-check-input\" type=\"checkbox\" value={post[0]}\n                                                           id={\"check\"+post[0]} onClick={()=>\n                                                        this.updateChangeList(post[0])\n                                                    }/>\n                                                </div> : null\n                                                }\n                                            </div>\n\n                                        </ListGroup.Item>\n\n                                        </div>\n                                    )\n                                })\n                            }\n                        </ListGroup>\n                        <Modal show={this.state.showDeletePostModal} onHide={this.closeModal}>\n                            <Modal.Header closeButton>\n                            <Modal.Title>Delete Posts</Modal.Title>\n                            </Modal.Header>\n                            <Modal.Body>Are you sure you want to delete the selected posts?</Modal.Body>\n                            <Modal.Footer>\n                            <Button variant=\"secondary\" onClick={this.closeModal}>\n                                Close\n                            </Button>\n                            <Button variant=\"danger\" onClick={async () => {\n                                this.closeModal();\n                                await this.deletePosts();\n                            }}>\n                                Delete\n                            </Button>\n                            </Modal.Footer>\n                        </Modal>\n                        <div className=\"delete-button\" style={{ display: this.isAdmin ? \"block\": \"none\" }}>\n                            <Button variant=\"danger\" onClick={this.openModal}>\n                                Delete selected posts\n                            </Button>\n                        </div>\n\n                    </div>\n\n                    <div className=\"post-main-panel\">\n                        { this.state.activeIndex || this.state.mainPanel || true ? this.renderMainPanel() : \"\" }\n                    </div>\n                </div>\n            </div>\n        )\n    }\n    \n}\n\nexport default Forum;"]},"metadata":{},"sourceType":"module"}